function initializeMap(){var a=$(document).width()>480?!0:!1,b=getLocationByIP();if(HAVELOCATION)var c=8;else var c=$(document).width()>480?4:3;var d={zoom:c,center:new google.maps.LatLng(b[0],b[1]),draggable:a,scrollwheel:!1},e=new google.maps.Map(document.getElementById("map-canvas"),d),f=document.getElementById("location-list"),g=new BCBranchesDataSource,h=new storeLocator.View(e,g,{markerIcon:"../images/map-icon-green.svg",geolocation:!1});new storeLocator.Panel(f,{locationSearchLabel:"Find a Center Near You",featureFilter:!1,directions:!1,view:h})}function getLocationByIP(){var a,b;return google.loader.ClientLocation?(a=google.loader.ClientLocation.latitude,b=google.loader.ClientLocation.longitude,HAVELOCATION=!0):(a=40,b=-100),[a,b]}function setDIVHeight(a){var b=$(a),c=b.offset().top,d=$(window).height(),e=d-c;b.height(e),b.show()}function BCBranchesDataSource(){}var LOCATIONDATA,HAVELOCATION=!1;$(window).resize(function(){var a=$(window).width();a>=992?($("div#map-canvas").show(),setDIVHeight("div#map-canvas"),setDIVHeight("div#location-list")):$("div#map-canvas").hide()}),$(document).ready(function(){$.getJSON("locations.json",function(a){LOCATIONDATA=a;var b=$(window).width();b>=992?(setDIVHeight("div#map-canvas"),setDIVHeight("div#location-list")):$("div#map-canvas").hide(),initializeMap()})}),BCBranchesDataSource.prototype.getStores=function(a,b,c){{var d=this,e=a.getCenter();"(ST_INTERSECTS(geometry, "+this.boundsToWkt_(a)+") OR ST_DISTANCE(geometry, "+this.latLngToWkt_(e)+") < 20000)"}$.getJSON("locations.json",function(a){var b=d.parse_(a);d.sortByDistance_(e,b),c(b)})},BCBranchesDataSource.prototype.latLngToWkt_=function(a){return"ST_POINT("+a.lng()+", "+a.lat()+")"},BCBranchesDataSource.prototype.boundsToWkt_=function(a){var b=a.getNorthEast(),c=a.getSouthWest();return["ST_GEOMFROMTEXT('POLYGON ((",c.lng()," ",c.lat(),", ",b.lng()," ",c.lat(),", ",b.lng()," ",b.lat(),", ",c.lng()," ",b.lat(),", ",c.lng()," ",c.lat(),"))')"].join("")},BCBranchesDataSource.prototype.parse_=function(a){for(var b,c=[],d=0;b=a[d];d++){var e=new google.maps.LatLng(b.Lat,b.Lon),f=b.Name,g="<p>"+b.Address+"<br>"+b.City+", "+b.State+" "+b.Zip+"</p>",h='<p><a href="#" class="branch-title">View Center Details <i class="fa fa-chevron-right"></i></a></p>',i=new storeLocator.Store(d,e,null,{title:f,address:g+h});c.push(i)}return c},BCBranchesDataSource.prototype.sortByDistance_=function(a,b){b.sort(function(b,c){return b.distanceTo(a)-c.distanceTo(a)})},function(a){"use strict";function b(a){return function(){return this[a]}}function c(){}function e(a){return a*A.PI/180}function f(a,b){this.b=a,this.a=b}function g(){this.a=[],this.b={};for(var a,b=0;a=arguments[b];b++)this.add(a)}function h(a){this.c=a.tableId,this.b=a.apiKey,a.propertiesModifier&&(this.a=a.propertiesModifier)}function i(a){return"ST_POINT("+a.lng()+", "+a.lat()+")"}function j(a){var b=a.getNorthEast();return a=a.getSouthWest(),["ST_GEOMFROMTEXT('POLYGON ((",a.lng()," ",a.lat(),", ",b.lng()," ",a.lat(),", ",b.lng()," ",b.lat(),", ",a.lng()," ",b.lat(),", ",a.lng()," ",a.lat(),"))')"][Z]("")}function k(a,b){b.sort(function(b,c){return b[R](a)-c[R](a)})}function l(b,c){this.g=a(b),this.g[O]("storelocator-panel"),this.c=a.extend({locationSearch:!0,locationSearchLabel:"Where are you?",featureFilter:!0,directions:!0,view:null},c),this.l=new google[K].DirectionsRenderer({draggable:!0}),this.s=new google[K].DirectionsService,m(this)}function m(b){if(b.c.view&&b.set("view",b.c.view),b.e=a('<form class="storelocator-filter"/>'),b.g[Y](b.e),b.c.locationSearch&&(b.i=a('<div class="location-search"><h4>'+b.c.locationSearchLabel+'</h4><input placeholder="Enter Zip Code or City"></div>'),b.e[Y](b.i),"undefined"!=typeof google[K].places?o(b):b.e.submit(function(){var c=a("input",b.i).val();b.searchPosition(c)}),b.e.submit(function(){return!1}),google[K][$][J](b,"geocode",function(a){if(a[F]){this.k=a[F].location,b.h&&p(b);var c=b.get("view");c[S](null);var d=c[L]();a[F].viewport?d.fitBounds(a[F].viewport):(d.setCenter(a[F].location),d.setZoom(13)),c.refreshView(),n(b)}else b.searchPosition(a.name)})),b.c.featureFilter){b.d=a('<div class="feature-filter"/>');for(var c=b.get("view").getFeatures().asList(),d=0,e=c[T];e>d;d++){var f=c[d],g=a('<input type="checkbox"/>');g.data("feature",f),a("<label/>")[Y](g)[Y](f.getDisplayName()).appendTo(b.d)}b.e[Y](b.d),b.d[I]("input").change(function(){var c=a(this).data("feature"),d=b.get("featureFilter");d.toggle(c),b.set("featureFilter",d),b.get("view").refreshView()})}b.b=a('<ul class="store-list"/>'),b.g[Y](b.b),b.c.directions&&(b.a=a('<div class="directions-panel"><form><input class="directions-to"/><input type="submit" value="Find directions"/><a href="#" class="close-directions">Close</a></form><div class="rendered-directions"></div></div>'),b.a[I](".directions-to")[G]("readonly","readonly"),b.a.hide(),b.h=!1,b.a[I]("form").submit(function(){return p(b),!1}),b.a[I](".close-directions")[Q](function(){b.hideDirections()}),b.g[Y](b.a))}function n(a){var b=a.get("view");a.r&&google[K][$][E](a.r),a.r=google[K][$].addListenerOnce(b,"stores_changed",function(){a.set("stores",b.get("stores"))})}function o(b){var c=a("input",b.i)[0];b.f=new google[K].places.Autocomplete(c),b.get("view")&&b.f[D]("bounds",b.get("view")[L]()),google[K][$][J](b.f,"place_changed",function(){google[K][$][C](b,"geocode",this.getPlace())})}function p(a){if(a.k&&a.m){var b=a.a[I](".rendered-directions").empty();a.s.route({origin:a.k,destination:a.m[B](),travelMode:google[K].DirectionsTravelMode.DRIVING},function(c,d){if(d==google[K].DirectionsStatus.OK){var e=a.l;e.setPanel(b[0]),e[X](a.get("view")[L]()),e.setDirections(c)}})}}function q(){this.b=[]}function r(a,b){b.sort(function(b,c){return b[R](a)-c[R](a)})}function s(a,b,c,d){this.f=a,this.d=b,this.a=c||_,this.b=d||{}}function t(a){for(var b=["title","address","phone","misc","web"],c=[],d=0,e=b[T];e>d;d++){var f=b[d];a.b[f]&&(c[N]('<div class="'),c[N](f),c[N]('">'),c[N](a.b[f]),c[N]("</div>"))}return c[Z]("")}function u(a){var b=[];b[N]('<ul class="features">'),a=a.a.asList();for(var c,d=0;c=a[d];d++)b[N]("<li>"),b[N](c.getDisplayName()),b[N]("</li>");return b[N]("</ul>"),b[Z]("")}function v(){}function w(b,c,d){this.g=b,this.f=c,this.b=a.extend({updateOnPan:!0,geolocation:!0,features:new g},d),y(this),google[K][$][C](this,"load"),this.set("featureFilter",new g)}function x(a){window.navigator&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(b){b=new google[K].LatLng(b.coords.latitude,b.coords.longitude),a[L]().setCenter(b),a[L]().setZoom(11),google[K][$][C](a,"load")},void 0,{maximumAge:6e4,timeout:1e4})}function y(a){a.b.geolocation&&x(a),a.c={},a.a=new google[K].InfoWindow;var b=a[L]();a.set("updateOnPan",a.b.updateOnPan),google[K][$][J](a.a,"closeclick",function(){a[S](null)}),google[K][$][J](b,"click",function(){a[S](null),a.a.close()})}var z,A=Math,B="getLocation",C="trigger",D="bindTo",E="removeListener",F="geometry",G="attr",H="getBounds",I="find",J="addListener",K="maps",L="getMap",M="contains",N="push",O="addClass",P="getCenter",Q="click",R="distanceTo",S="highlight",T="length",U="prototype",V="getId",W="getMarker",X="setMap",Y="append",Z="join",$="event";window.storeLocator=c,c.Feature=f,f[U].getId=b("b"),f[U].getDisplayName=b("a"),f[U].toString=function(){return this.getDisplayName()},c.FeatureSet=g,z=g[U],z.toggle=function(a){this[M](a)?this.remove(a):this.add(a)},z.contains=function(a){return a[V]()in this.b},z.getById=function(a){return a in this.b?this.a[this.b[a]]:null},z.add=function(a){a&&(this.a[N](a),this.b[a[V]()]=this.a[T]-1)},z.remove=function(a){this[M](a)&&(this.a[this.b[a[V]()]]=null,delete this.b[a[V]()])},z.asList=function(){for(var a=[],b=0,c=this.a[T];c>b;b++){var d=this.a[b];null!==d&&a[N](d)}return a};var _=new g;c.GMEDataFeed=h,h[U].getStores=function(b,c,d){var e=this,f=b[P]();b="(ST_INTERSECTS(geometry, "+j(b)+") OR ST_DISTANCE(geometry, "+i(f)+") < 20000)",a.getJSON("https://www.googleapis.com/mapsengine/v1/tables/"+this.c+"/features?callback=?",{key:this.b,where:b,version:"published",maxResults:300},function(a){if(a.error)window.alert(a.error.message),a=[];else if(a=a.features){for(var b,c=[],g=0;b=a[g];g++){var h=b[F].coordinates,h=new google[K].LatLng(h[1],h[0]);b=e.a(b.properties),c[N](new s(b.id,h,null,b))}a=c}else a=[];k(f,a),d(a)})},h[U].a=function(a){return a},c.Panel=l,l.prototype=new google[K].MVCObject;var ab=new google[K].Geocoder;z=l[U],z.searchPosition=function(a){var b=this;a={address:a,bounds:this.get("view")[L]()[H]()},ab.geocode(a,function(a,c){c==google[K].GeocoderStatus.OK&&google[K][$][C](b,"geocode",a[0])})},z.setView=function(a){this.set("view",a)},z.view_changed=function(){function a(){b.clearMarkers(),n(c)}var b=this.get("view");this[D]("selectedStore",b);var c=this;this.o&&google[K][$][E](this.o),this.q&&google[K][$][E](this.q),this.p&&google[K][$][E](this.p),b[L](),this.o=google[K][$][J](b,"load",a),this.q=google[K][$][J](b[L](),"zoom_changed",a),this.p=google[K][$][J](b[L](),"idle",function(){var a=b[L]();c.j?a[H]()[M](c.j)||(c.j=a[P](),n(c)):c.j=a[P]()}),a(),this[D]("featureFilter",b),this.f&&this.f[D]("bounds",b[L]())},z.stores_changed=function(){if(this.get("stores")){var b=this.get("view"),c=b&&b[L]()[H](),d=this.get("stores"),e=this.get("selectedStore");this.b.empty(),d[T]?c&&!c[M](d[0][B]())&&this.b[Y]('<li class="no-stores">There are no BC centers in this area. However, the centers closest to you are listed below.</li>'):this.b[Y]('<li class="no-stores">There are no BC centers in this area.</li>');for(var c=function(){b[S](this.store,!0)},f=0,g=A.min(10,d[T]);g>f;f++){var h=d[f].getInfoPanelItem();h.store=d[f],e&&d[f][V]()==e[V]()&&a(h)[O]("highlighted"),h.t||(h.t=google[K][$].addDomListener(h,"click",c)),this.b[Y](h)}}},z.selectedStore_changed=function(){a(".highlighted",this.b).removeClass("highlighted");var b=this,c=this.get("selectedStore");if(c){this.m=c,this.b[I]("#store-"+c[V]())[O]("highlighted"),this.c.directions&&this.a[I](".directions-to").val(c.getDetails().title);var e=b.get("view").getInfoWindow().getContent(),f=a("<a/>").text("Zoom here")[G]("href","#")[O]("action")[O]("zoomhere"),g=a("<a/>").text("Street view")[G]("href","#")[O]("action")[O]("streetview");f[Q](function(){b.get("view")[L]().setOptions({center:c[B](),zoom:16})}),g[Q](function(){var a=b.get("view")[L]().getStreetView();a.setPosition(c[B]()),a.setVisible(!0)}),a(e)[Y](d)[Y](f)[Y](g)}},z.hideDirections=function(){this.h=!1,this.a.fadeOut(),this.d.fadeIn(),this.b.fadeIn(),this.l[X](null)},z.showDirections=function(){var a=this.get("selectedStore");this.d.fadeOut(),this.b.fadeOut(),this.a[I](".directions-to").val(a.getDetails().title),this.a.fadeIn(),p(this),this.h=!0},z.featureFilter_changed=function(){n(this)},c.StaticDataFeed=q,q[U].setStores=function(a){this.b=a,this.a?this.a():delete this.a},q[U].getStores=function(a,b,c){if(this.b[T]){for(var d,e=[],f=0;d=this.b[f];f++)d.hasAllFeatures(b)&&e[N](d);r(a[P](),e),c(e)}else{var g=this;this.a=function(){g.getStores(a,b,c)}}},c.Store=s,z=s[U],z.setMarker=function(a){this.e=a,google[K][$][C](this,"marker_changed",a)},z.getMarker=b("e"),z.getId=b("f"),z.getLocation=b("d"),z.getFeatures=b("a"),z.hasFeature=function(a){return this.a[M](a)},z.hasAllFeatures=function(a){if(!a)return!0;a=a.asList();for(var b=0,c=a[T];c>b;b++)if(!this.hasFeature(a[b]))return!1;return!0},z.getDetails=b("b"),z.getInfoWindowContent=function(){if(!this.c){var a=['<div class="store">'];a[N](t(this)),a[N](u(this)),a[N]("</div>"),this.c=a[Z]("")}return this.c},z.getInfoPanelContent=function(){return this.getInfoWindowContent()};var bb={};s[U].getInfoPanelItem=function(){var b=this[V]();if(!bb[b]){var c=this.getInfoPanelContent();bb[b]=a('<li class="store" id="store-'+this[V]()+'">'+c+"</li>")[0]}return bb[b]},s[U].distanceTo=function(a){var b=this[B](),c=e(b.lat()),d=e(b.lng()),b=e(a.lat()),f=e(a.lng());return a=b-c,d=f-d,c=A.sin(a/2)*A.sin(a/2)+A.cos(c)*A.cos(b)*A.sin(d/2)*A.sin(d/2),12742*A.atan2(A.sqrt(c),A.sqrt(1-c))},c.DataFeed=v,v[U].getStores=function(){},c.View=w,w.prototype=new google[K].MVCObject,z=w[U],z.updateOnPan_changed=function(){if(this.e&&google[K][$][E](this.e),this.get("updateOnPan")&&this[L]()){var a=this,b=this[L]();this.e=google[K][$][J](b,"idle",function(){a.refreshView()})}},z.addStoreToMap=function(a){var b=this[W](a);a.setMarker(b);var c=this;b.n=google[K][$][J](b,"click",function(){c[S](a,!1)}),b[L]()!=this[L]()&&b[X](this[L]())},z.createMarker=function(a){a={position:a[B]()};var b=this.b.markerIcon;return b&&(a.icon=b),new google[K].Marker(a)},z.getMarker=function(a){var b=this.c,c=a[V]();return b[c]||(b[c]=this.createMarker(a)),b[c]},z.getInfoWindow=function(b){return b?(b=a(b.getInfoWindowContent()),this.a.setContent(b[0]),this.a):this.a},z.getFeatures=function(){return this.b.features},z.getFeatureById=function(a){if(!this.d){this.d={};for(var b,c=0;b=this.b.features[c];c++)this.d[b[V]()]=b}return this.d[a]},z.featureFilter_changed=function(){google[K][$][C](this,"featureFilter_changed",this.get("featureFilter")),this.get("stores")&&this.clearMarkers()},z.clearMarkers=function(){for(var a in this.c){this.c[a][X](null);var b=this.c[a].n;b&&google[K][$][E](b)}},z.refreshView=function(){var a=this;this.f.getStores(this[L]()[H](),this.get("featureFilter"),function(b){var c=a.get("stores");if(c)for(var d=0,e=c[T];e>d;d++)google[K][$][E](c[d][W]().n);a.set("stores",b)})},z.stores_changed=function(){for(var a,b=this.get("stores"),c=0;a=b[c];c++)this.addStoreToMap(a)},z.getMap=b("g"),z.highlight=function(a,b){var c=this.getInfoWindow(a);a?(c=this.getInfoWindow(a),a[W]()?c.open(this[L](),a[W]()):(c.setPosition(a[B]()),c.open(this[L]())),b&&this[L]().panTo(a[B]()),this[L]().getStreetView().getVisible()&&this[L]().getStreetView().setPosition(a[B]())):c.close(),this.set("selectedStore",a)},z.selectedStore_changed=function(){google[K][$][C](this,"selectedStore_changed",this.get("selectedStore"))}}(jQuery);
//# sourceMappingURL=sourcemap.map