function initializeMap(){var a=$(document).width()>480?!0:!1,b=getLocationByIP();if(HAVELOCATION)var c=8;else var c=$(document).width()>480?4:3;var d={zoom:c,center:new google.maps.LatLng(b[0],b[1]),draggable:a,scrollwheel:!1},e=new google.maps.Map(document.getElementById("map-canvas"),d),f=document.getElementById("location-list"),g=new BCBranchesDataSource;console.log(g);var h=new storeLocator.View(e,g,{markerIcon:"../images/map-icon-green.svg",geolocation:!1});new storeLocator.Panel(f,{locationSearchLabel:"Find a Center Near You",featureFilter:!1,directions:!1,view:h})}function getLocationByIP(){var a,b;return google.loader.ClientLocation?(a=google.loader.ClientLocation.latitude,b=google.loader.ClientLocation.longitude,HAVELOCATION=!0):(a=40,b=-100),[a,b]}function setDIVHeight(a){var b=$(a),c=b.offset().top,d=$(window).height(),e=d-c;b.height(e),b.show()}function BCBranchesDataSource(){}var LOCATIONDATA,MAPISLODADED=!1,HAVELOCATION=!1;$(window).resize(function(){var a=$(window).width();a>=992?MAPISLODADED?(setDIVHeight("div#map-canvas"),setDIVHeight("div#location-list")):LOCATIONDATA&&(MAPISLODADED=!0,initializeMap()):MAPISLODADED&&$("div#map-canvas").hide()}),$(document).ready(function(){$.getJSON("locations.json",function(a){LOCATIONDATA=a;var b=$(window).width();b>=992&&(setDIVHeight("div#map-canvas"),setDIVHeight("div#location-list"),MAPISLODADED=!0,initializeMap())})}),BCBranchesDataSource.prototype.getStores=function(a,b,c){{var d=this,e=a.getCenter();"(ST_INTERSECTS(geometry, "+this.boundsToWkt_(a)+") OR ST_DISTANCE(geometry, "+this.latLngToWkt_(e)+") < 20000)"}$.getJSON("locations.json",function(a){var b=d.parse_(a);d.sortByDistance_(e,b),c(b)})},BCBranchesDataSource.prototype.latLngToWkt_=function(a){return"ST_POINT("+a.lng()+", "+a.lat()+")"},BCBranchesDataSource.prototype.boundsToWkt_=function(a){var b=a.getNorthEast(),c=a.getSouthWest();return["ST_GEOMFROMTEXT('POLYGON ((",c.lng()," ",c.lat(),", ",b.lng()," ",c.lat(),", ",b.lng()," ",b.lat(),", ",c.lng()," ",b.lat(),", ",c.lng()," ",c.lat(),"))')"].join("")},BCBranchesDataSource.prototype.parse_=function(a){for(var b,c=[],d=0;b=a[d];d++){var e=new google.maps.LatLng(b.Lat,b.Lon),f=b.Name,g=b.Address+"<br>"+b.City+", "+b.State+" "+b.Zip,h=new storeLocator.Store(d,e,null,{title:f,address:g});c.push(h)}return c},BCBranchesDataSource.prototype.sortByDistance_=function(a,b){b.sort(function(b,c){return b.distanceTo(a)-c.distanceTo(a)})},function(a){"use strict";function b(a){return function(){return this[a]}}function c(){}function d(a){return a*z.PI/180}function e(a,b){this.b=a,this.a=b}function f(){this.a=[],this.b={};for(var a,b=0;a=arguments[b];b++)this.add(a)}function g(a){this.c=a.tableId,this.b=a.apiKey,a.propertiesModifier&&(this.a=a.propertiesModifier)}function h(a){return"ST_POINT("+a.lng()+", "+a.lat()+")"}function i(a){var b=a.getNorthEast();return a=a.getSouthWest(),["ST_GEOMFROMTEXT('POLYGON ((",a.lng()," ",a.lat(),", ",b.lng()," ",a.lat(),", ",b.lng()," ",b.lat(),", ",a.lng()," ",b.lat(),", ",a.lng()," ",a.lat(),"))')"][Y]("")}function j(a,b){b.sort(function(b,c){return b[Q](a)-c[Q](a)})}function k(b,c){this.g=a(b),this.g[N]("storelocator-panel"),this.c=a.extend({locationSearch:!0,locationSearchLabel:"Where are you?",featureFilter:!0,directions:!0,view:null},c),this.l=new google[J].DirectionsRenderer({draggable:!0}),this.s=new google[J].DirectionsService,l(this)}function l(b){if(b.c.view&&b.set("view",b.c.view),b.e=a('<form class="storelocator-filter"/>'),b.g[X](b.e),b.c.locationSearch&&(b.i=a('<div class="location-search"><h4>'+b.c.locationSearchLabel+'</h4><input placeholder="Enter Zip Code or City"></div>'),b.e[X](b.i),"undefined"!=typeof google[J].places?n(b):b.e.submit(function(){var c=a("input",b.i).val();b.searchPosition(c)}),b.e.submit(function(){return!1}),google[J][Z][I](b,"geocode",function(a){if(a[E]){this.k=a[E].location,b.h&&o(b);var c=b.get("view");c[R](null);var d=c[K]();a[E].viewport?d.fitBounds(a[E].viewport):(d.setCenter(a[E].location),d.setZoom(13)),c.refreshView(),m(b)}else b.searchPosition(a.name)})),b.c.featureFilter){b.d=a('<div class="feature-filter"/>');for(var c=b.get("view").getFeatures().asList(),d=0,e=c[S];e>d;d++){var f=c[d],g=a('<input type="checkbox"/>');g.data("feature",f),a("<label/>")[X](g)[X](f.getDisplayName()).appendTo(b.d)}b.e[X](b.d),b.d[H]("input").change(function(){var c=a(this).data("feature"),d=b.get("featureFilter");d.toggle(c),b.set("featureFilter",d),b.get("view").refreshView()})}b.b=a('<ul class="store-list"/>'),b.g[X](b.b),b.c.directions&&(b.a=a('<div class="directions-panel"><form><input class="directions-to"/><input type="submit" value="Find directions"/><a href="#" class="close-directions">Close</a></form><div class="rendered-directions"></div></div>'),b.a[H](".directions-to")[F]("readonly","readonly"),b.a.hide(),b.h=!1,b.a[H]("form").submit(function(){return o(b),!1}),b.a[H](".close-directions")[P](function(){b.hideDirections()}),b.g[X](b.a))}function m(a){var b=a.get("view");a.r&&google[J][Z][D](a.r),a.r=google[J][Z].addListenerOnce(b,"stores_changed",function(){a.set("stores",b.get("stores"))})}function n(b){var c=a("input",b.i)[0];b.f=new google[J].places.Autocomplete(c),b.get("view")&&b.f[C]("bounds",b.get("view")[K]()),google[J][Z][I](b.f,"place_changed",function(){google[J][Z][B](b,"geocode",this.getPlace())})}function o(a){if(a.k&&a.m){var b=a.a[H](".rendered-directions").empty();a.s.route({origin:a.k,destination:a.m[A](),travelMode:google[J].DirectionsTravelMode.DRIVING},function(c,d){if(d==google[J].DirectionsStatus.OK){var e=a.l;e.setPanel(b[0]),e[W](a.get("view")[K]()),e.setDirections(c)}})}}function p(){this.b=[]}function q(a,b){b.sort(function(b,c){return b[Q](a)-c[Q](a)})}function r(a,b,c,d){this.f=a,this.d=b,this.a=c||$,this.b=d||{}}function s(a){for(var b=["title","address","phone","misc","web"],c=[],d=0,e=b[S];e>d;d++){var f=b[d];a.b[f]&&(c[M]('<div class="'),c[M](f),c[M]('">'),c[M](a.b[f]),c[M]("</div>"))}return c[Y]("")}function t(a){var b=[];b[M]('<ul class="features">'),a=a.a.asList();for(var c,d=0;c=a[d];d++)b[M]("<li>"),b[M](c.getDisplayName()),b[M]("</li>");return b[M]("</ul>"),b[Y]("")}function u(){}function v(b,c,d){this.g=b,this.f=c,this.b=a.extend({updateOnPan:!0,geolocation:!0,features:new f},d),x(this),google[J][Z][B](this,"load"),this.set("featureFilter",new f)}function w(a){window.navigator&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(b){b=new google[J].LatLng(b.coords.latitude,b.coords.longitude),a[K]().setCenter(b),a[K]().setZoom(11),google[J][Z][B](a,"load")},void 0,{maximumAge:6e4,timeout:1e4})}function x(a){a.b.geolocation&&w(a),a.c={},a.a=new google[J].InfoWindow;var b=a[K]();a.set("updateOnPan",a.b.updateOnPan),google[J][Z][I](a.a,"closeclick",function(){a[R](null)}),google[J][Z][I](b,"click",function(){a[R](null),a.a.close()})}var y,z=Math,A="getLocation",B="trigger",C="bindTo",D="removeListener",E="geometry",F="attr",G="getBounds",H="find",I="addListener",J="maps",K="getMap",L="contains",M="push",N="addClass",O="getCenter",P="click",Q="distanceTo",R="highlight",S="length",T="prototype",U="getId",V="getMarker",W="setMap",X="append",Y="join",Z="event";window.storeLocator=c,c.Feature=e,e[T].getId=b("b"),e[T].getDisplayName=b("a"),e[T].toString=function(){return this.getDisplayName()},c.FeatureSet=f,y=f[T],y.toggle=function(a){this[L](a)?this.remove(a):this.add(a)},y.contains=function(a){return a[U]()in this.b},y.getById=function(a){return a in this.b?this.a[this.b[a]]:null},y.add=function(a){a&&(this.a[M](a),this.b[a[U]()]=this.a[S]-1)},y.remove=function(a){this[L](a)&&(this.a[this.b[a[U]()]]=null,delete this.b[a[U]()])},y.asList=function(){for(var a=[],b=0,c=this.a[S];c>b;b++){var d=this.a[b];null!==d&&a[M](d)}return a};var $=new f;c.GMEDataFeed=g,g[T].getStores=function(b,c,d){var e=this,f=b[O]();b="(ST_INTERSECTS(geometry, "+i(b)+") OR ST_DISTANCE(geometry, "+h(f)+") < 20000)",a.getJSON("https://www.googleapis.com/mapsengine/v1/tables/"+this.c+"/features?callback=?",{key:this.b,where:b,version:"published",maxResults:300},function(a){if(a.error)window.alert(a.error.message),a=[];else if(a=a.features){for(var b,c=[],g=0;b=a[g];g++){var h=b[E].coordinates,h=new google[J].LatLng(h[1],h[0]);b=e.a(b.properties),c[M](new r(b.id,h,null,b))}a=c}else a=[];j(f,a),d(a)})},g[T].a=function(a){return a},c.Panel=k,k.prototype=new google[J].MVCObject;var _=new google[J].Geocoder;y=k[T],y.searchPosition=function(a){var b=this;a={address:a,bounds:this.get("view")[K]()[G]()},_.geocode(a,function(a,c){c==google[J].GeocoderStatus.OK&&google[J][Z][B](b,"geocode",a[0])})},y.setView=function(a){this.set("view",a)},y.view_changed=function(){function a(){b.clearMarkers(),m(c)}var b=this.get("view");this[C]("selectedStore",b);var c=this;this.o&&google[J][Z][D](this.o),this.q&&google[J][Z][D](this.q),this.p&&google[J][Z][D](this.p),b[K](),this.o=google[J][Z][I](b,"load",a),this.q=google[J][Z][I](b[K](),"zoom_changed",a),this.p=google[J][Z][I](b[K](),"idle",function(){var a=b[K]();c.j?a[G]()[L](c.j)||(c.j=a[O](),m(c)):c.j=a[O]()}),a(),this[C]("featureFilter",b),this.f&&this.f[C]("bounds",b[K]())},y.stores_changed=function(){if(this.get("stores")){var b=this.get("view"),c=b&&b[K]()[G](),d=this.get("stores"),e=this.get("selectedStore");this.b.empty(),d[S]?c&&!c[L](d[0][A]())&&this.b[X]('<li class="no-stores">There are no BC centers in this area. However, the centers closest to you are listed below.</li>'):this.b[X]('<li class="no-stores">There are no BC centers in this area.</li>');for(var c=function(){b[R](this.store,!0)},f=0,g=z.min(10,d[S]);g>f;f++){var h=d[f].getInfoPanelItem();h.store=d[f],e&&d[f][U]()==e[U]()&&a(h)[N]("highlighted"),h.t||(h.t=google[J][Z].addDomListener(h,"click",c)),this.b[X](h)}}},y.selectedStore_changed=function(){a(".highlighted",this.b).removeClass("highlighted");var b=this,c=this.get("selectedStore");if(c){this.m=c,this.b[H]("#store-"+c[U]())[N]("highlighted"),this.c.directions&&this.a[H](".directions-to").val(c.getDetails().title);var d=b.get("view").getInfoWindow().getContent(),e=a("<a/>").text("Directions")[F]("href","#")[N]("action")[N]("directions"),f=a("<a/>").text("Zoom here")[F]("href","#")[N]("action")[N]("zoomhere"),g=a("<a/>").text("Street view")[F]("href","#")[N]("action")[N]("streetview");e[P](function(){return b.showDirections(),!1}),f[P](function(){b.get("view")[K]().setOptions({center:c[A](),zoom:16})}),g[P](function(){var a=b.get("view")[K]().getStreetView();a.setPosition(c[A]()),a.setVisible(!0)}),a(d)[X](e)[X](f)[X](g)}},y.hideDirections=function(){this.h=!1,this.a.fadeOut(),this.d.fadeIn(),this.b.fadeIn(),this.l[W](null)},y.showDirections=function(){var a=this.get("selectedStore");this.d.fadeOut(),this.b.fadeOut(),this.a[H](".directions-to").val(a.getDetails().title),this.a.fadeIn(),o(this),this.h=!0},y.featureFilter_changed=function(){m(this)},c.StaticDataFeed=p,p[T].setStores=function(a){this.b=a,this.a?this.a():delete this.a},p[T].getStores=function(a,b,c){if(this.b[S]){for(var d,e=[],f=0;d=this.b[f];f++)d.hasAllFeatures(b)&&e[M](d);q(a[O](),e),c(e)}else{var g=this;this.a=function(){g.getStores(a,b,c)}}},c.Store=r,y=r[T],y.setMarker=function(a){this.e=a,google[J][Z][B](this,"marker_changed",a)},y.getMarker=b("e"),y.getId=b("f"),y.getLocation=b("d"),y.getFeatures=b("a"),y.hasFeature=function(a){return this.a[L](a)},y.hasAllFeatures=function(a){if(!a)return!0;a=a.asList();for(var b=0,c=a[S];c>b;b++)if(!this.hasFeature(a[b]))return!1;return!0},y.getDetails=b("b"),y.getInfoWindowContent=function(){if(!this.c){var a=['<div class="store">'];a[M](s(this)),a[M](t(this)),a[M]("</div>"),this.c=a[Y]("")}return this.c},y.getInfoPanelContent=function(){return this.getInfoWindowContent()};var ab={};r[T].getInfoPanelItem=function(){var b=this[U]();if(!ab[b]){var c=this.getInfoPanelContent();ab[b]=a('<li class="store" id="store-'+this[U]()+'">'+c+"</li>")[0]}return ab[b]},r[T].distanceTo=function(a){var b=this[A](),c=d(b.lat()),e=d(b.lng()),b=d(a.lat()),f=d(a.lng());return a=b-c,e=f-e,c=z.sin(a/2)*z.sin(a/2)+z.cos(c)*z.cos(b)*z.sin(e/2)*z.sin(e/2),12742*z.atan2(z.sqrt(c),z.sqrt(1-c))},c.DataFeed=u,u[T].getStores=function(){},c.View=v,v.prototype=new google[J].MVCObject,y=v[T],y.updateOnPan_changed=function(){if(this.e&&google[J][Z][D](this.e),this.get("updateOnPan")&&this[K]()){var a=this,b=this[K]();this.e=google[J][Z][I](b,"idle",function(){a.refreshView()})}},y.addStoreToMap=function(a){var b=this[V](a);a.setMarker(b);var c=this;b.n=google[J][Z][I](b,"click",function(){c[R](a,!1)}),b[K]()!=this[K]()&&b[W](this[K]())},y.createMarker=function(a){a={position:a[A]()};var b=this.b.markerIcon;return b&&(a.icon=b),new google[J].Marker(a)},y.getMarker=function(a){var b=this.c,c=a[U]();return b[c]||(b[c]=this.createMarker(a)),b[c]},y.getInfoWindow=function(b){return b?(b=a(b.getInfoWindowContent()),this.a.setContent(b[0]),this.a):this.a},y.getFeatures=function(){return this.b.features},y.getFeatureById=function(a){if(!this.d){this.d={};for(var b,c=0;b=this.b.features[c];c++)this.d[b[U]()]=b}return this.d[a]},y.featureFilter_changed=function(){google[J][Z][B](this,"featureFilter_changed",this.get("featureFilter")),this.get("stores")&&this.clearMarkers()},y.clearMarkers=function(){for(var a in this.c){this.c[a][W](null);var b=this.c[a].n;b&&google[J][Z][D](b)}},y.refreshView=function(){var a=this;this.f.getStores(this[K]()[G](),this.get("featureFilter"),function(b){var c=a.get("stores");if(c)for(var d=0,e=c[S];e>d;d++)google[J][Z][D](c[d][V]().n);a.set("stores",b)})},y.stores_changed=function(){for(var a,b=this.get("stores"),c=0;a=b[c];c++)this.addStoreToMap(a)},y.getMap=b("g"),y.highlight=function(a,b){var c=this.getInfoWindow(a);a?(c=this.getInfoWindow(a),a[V]()?c.open(this[K](),a[V]()):(c.setPosition(a[A]()),c.open(this[K]())),b&&this[K]().panTo(a[A]()),this[K]().getStreetView().getVisible()&&this[K]().getStreetView().setPosition(a[A]())):c.close(),this.set("selectedStore",a)},y.selectedStore_changed=function(){google[J][Z][B](this,"selectedStore_changed",this.get("selectedStore"))}}(jQuery);
//# sourceMappingURL=sourcemap.map